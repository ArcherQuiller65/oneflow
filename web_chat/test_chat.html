<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        .test-content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .instructions {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
    <link rel="stylesheet" href="/api/userdata/user.css"/>
</head>
<body>
    <div class="test-content">
        <h1>OneFlow Chat Widget Test</h1>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <p>This page tests the OneFlow AI Chat Widget integration. You should see a floating chat button in the bottom-right corner.</p>
            <ul>
                <li>Look for a purple circular button in the bottom-right corner</li>
                <li>Click it to open the chat interface</li>
                <li>Try asking: "Generate a simple text and display it as an image"</li>
            </ul>
        </div>
        
        <div class="debug-info">
            <h3>Debug Information:</h3>
            <p>Chat Widget Status: <span id="widget-status">Loading...</span></p>
            <p>API Status: <span id="api-status">Checking...</span></p>
            <p>Nodes Available: <span id="nodes-count">Loading...</span></p>
        </div>
        
        <div style="height: 500px; background: #f8f9fa; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin: 20px 0;">
            <p style="color: #666; font-size: 18px;">Main Content Area - Chat widget should appear over this</p>
        </div>
    </div>

    <script src="/api/userdata/chat_widget.js"></script>
    <script>
        // Debug script to check widget status
        setTimeout(() => {
            const statusEl = document.getElementById('widget-status');
            const apiStatusEl = document.getElementById('api-status');
            const nodesCountEl = document.getElementById('nodes-count');
            
            if (window.oneFlowChat) {
                statusEl.textContent = 'Loaded ✓';
                statusEl.style.color = 'green';
            } else {
                statusEl.textContent = 'Not Found ✗';
                statusEl.style.color = 'red';
            }
            
            // Check API
            fetch('/api/chat/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        apiStatusEl.textContent = 'Connected ✓';
                        apiStatusEl.style.color = 'green';
                        nodesCountEl.textContent = data.nodes_loaded + ' nodes';
                        nodesCountEl.style.color = 'green';
                    } else {
                        apiStatusEl.textContent = 'Error ✗';
                        apiStatusEl.style.color = 'red';
                    }
                })
                .catch(error => {
                    apiStatusEl.textContent = 'Failed ✗';
                    apiStatusEl.style.color = 'red';
                    console.error('API check failed:', error);
                });
        }, 2000);
    </script>
</body>
</html>